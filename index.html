<!DOCTYPE html>
<html>

<head>
    <title>Geolocation</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
        #map_canvas {
            height: 100%;
            width: 88%;
            float: right;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #text {
            height: 100%;
            width: 125px;
            float: left;
            margin: 0 auto;
            padding: 0px;
            text-align: center;
        }
    </style>

</head>

<body>
    <div id="text">
        欲輸入資料1：<input id='Text1' type="text">
        欲輸入資料2：<input id='Text2' type="text">
        欲輸入資料3：<input id='Text3' type="text">
        欲輸入資料4：<input id='Text4' type="text">
        欲輸入資料5：<input id='Text5' type="text">
        <button id='btn'>儲存資料</button>
        </br>
        <script>
            var dt = new Date();
            document.write(dt);
        </script>
        <script src="https://www.gstatic.com/firebasejs/5.4.1/firebase.js"></script>
        <script src='https://cdn.firebase.com/js/client/1.0.17/firebase.js'></script>
        <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js'></script>

        <script src="https://maps.googleapis.com/maps/api/js"></script>
        <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
        <script src="https://cdn.firebase.com/libs/geofire/4.1.2/geofire.min.js"></script>
        <script>
            var config = {
                apiKey: "AIzaSyDW09TKNQTWzQSdLXadKUrh4B9ciEpwDB8",
                authDomain: "my-new-project-f39fe.firebaseapp.com",
                databaseURL: "https://my-new-project-f39fe.firebaseio.com",
                projectId: "my-new-project-f39fe",
                storageBucket: "my-new-project-f39fe.appspot.com",
                messagingSenderId: "557151862788"
            };
            firebase.initializeApp(config);

            var btn = document.getElementById('btn');
            btn.onclick = function () {
                var Text1 = document.getElementById('Text1').value;
                var Text2 = document.getElementById('Text2').value;
                var Text3 = document.getElementById('Text3').value;
                var Text4 = document.getElementById('Text4').value;
                var Text5 = document.getElementById('Text5').value;
                var dt = new Date().getFullYear();
                var dt1 = new Date().getMonth();
                var dt2 = new Date().getDate();
                var dt3 = new Date().getHours();
                var dt4 = new Date().getMinutes();
                var dt5 = new Date().getSeconds();
                firebase.database().ref(locationsRef).push({
                    a: lat,
                    b: lng,
                    c: Text1,
                    d: Text2,
                    e: Text3,
                    f: Text4,
                    Year: dt,
                    Month: dt1,
                    Date: dt2,
                    Hours: dt3,
                    Minutes: dt4,
                    Seconds: dt5,

                });
            }
            //Create a node at firebase location to add locations as child keys
            var locationsRef = firebase.database().ref("locations/123");

        </script>
    </div>
    <div id="map_canvas">
        <script>
            function initialize() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function (position) {
                        lat = position.coords.latitude;
                        lng = position.coords.longitude;
                        var pos = { lat: lat, lng: lng };

                        var infowindow = new google.maps.InfoWindow();
                        var map = new google.maps.Map(
                            document.getElementById("map_canvas"), {
                                center: { lat: lat, lng: lng },
                                zoom: 8,
                                mapTypeId: google.maps.MapTypeId.ROADMAP
                            });

                        var locationsRef = firebase.database().ref("locations/123");
                        var bounds = new google.maps.LatLngBounds();
                        locationsRef.on('child_added', function (snapshot, prevChildKey) {
                            var data = snapshot.val();
                            console.log(data);
                            var marker = new google.maps.Marker({
                                position: {
                                    lat: data.a,
                                    lng: data.b
                                },
                                map: map
                            });
                            bounds.extend(marker.getPosition());
                            marker.addListener('click', (function (data) {
                                return function (e) {
                                    infowindow.setContent(this.getPosition().toUrlValue(6) + "<br>" + data.c + "<br>" + data.d + "<br>" + data.e + "<br>" + data.f + "<br>" + data.Year + "/" + data.Month + "/" + data.Date + ";" + data.Hours + ":" + data.Minutes + ":" + data.Seconds);
                                    infowindow.open(map, this);
                                }
                            }(data)));
                            map.fitBounds(bounds);
                        });
                    });
                }
            }

            google.maps.event.addDomListener(window, "load", initialize);
        </script>
    </div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA-noIUiDieN7p6P3eIGRXpWmujZyxwvy0&callback=initMap">
    </script>


</body>

</html>